#!/bin/bash --login
# -l mem512
#$ -cwd
#$ -t 1-22

# Load any required modulefiles
module load apps/binapps/plink2/20211217
module load apps/gcc/R/4.2.2

# Now the commands to be run by the job

chromosome_analysis () {
	chr=$1
	
	for filename in /mnt/mhs01-home01/KMuir/y78216vh/PRACTICAL_Data/iCOGS/Imputation_1kg_v3/chr$chr/*; do

		echo $filename

		plink2 --keep pa_double.csv --gen $filename ref-unknown --sample /mnt/mhs01-home01/KMuir/y78216vh/PRACTICAL_Data/iCOGS/Imputation_1kg_v3/icogs.sample --export bgen-1.3 --chr $chr --oxford-single-chr $1 --out "padata$1"
		
			~/software/GEM/GEM_1.4.5_static --bgen "padata$1.bgen" --sample padata$chr.sample --pheno-file ../../cca_pa.pheno --sampleid-name ID_1 --pheno-name CaCo --exposure-names P_Activity --robust 1 --center 0 --missing-value NaN --out "pacca$chr.out"

		
		#report results
		Rscript ~/PRACTICAL_Data_Analysis/prs_environment_analysis/12-3/icogs_report.R $chr

		echo $filename

	done
}

chromosome_analysis $SGE_TASK_ID
